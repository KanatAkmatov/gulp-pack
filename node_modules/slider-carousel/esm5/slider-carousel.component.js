import { Component, OnInit, HostBinding, Input, ElementRef, ViewChild, OnDestroy, OnChanges, Renderer2 } from '@angular/core';
import { DomSanitizer, SafeUrl, SafeStyle } from '@angular/platform-browser';
import { Helper } from './helper';
var SliderCarouselComponent = /** @class */ (function () {
    function SliderCarouselComponent(sanitizer, renderer, helper) {
        this.sanitizer = sanitizer;
        this.renderer = renderer;
        this.helper = helper;
        this.class = true;
        this.images = [];
        this.preview = true;
        this.height = '500px';
        this.width = '100%';
        this.maxWidth = '100%';
        this.autoSize = false;
        this.safeImages = [];
        this.initialized = false;
        this.currentImageIndex = 0;
        this.lastDirectionIsRight = false;
        this.containerWidth = 0;
        this.destroyed = false;
        this.windowResizing = false;
        this.listeners = [];
        this.drag = {
            state: 'none',
            startOffset: 0,
            currentOffset: 0,
            startLeft: 0,
            currentLeft: 0,
        };
    }
    Object.defineProperty(SliderCarouselComponent.prototype, "currentImage", {
        get: function () { return this.safeImages[this.currentImageIndex]; },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SliderCarouselComponent.prototype, "currentIsFisrt", {
        get: function () { return this.currentImageIndex === 0; },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SliderCarouselComponent.prototype, "currentIsLast", {
        get: function () { return this.currentImageIndex === (this.images.length - 1); },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(SliderCarouselComponent.prototype, "isDragging", {
        get: function () { return this.drag.state !== 'none'; },
        enumerable: false,
        configurable: true
    });
    SliderCarouselComponent.prototype.ngOnInit = function () {
    };
    SliderCarouselComponent.prototype.ngOnChanges = function () {
        this.prepare();
    };
    SliderCarouselComponent.prototype.prepare = function () {
        if (typeof this.height !== 'string')
            this.height = '500px';
        else if (!this.height.endsWith('%') && !this.height.endsWith('px'))
            this.height += 'px';
        if (typeof this.width !== 'string')
            this.width = '100%';
        else if (!this.width.endsWith('%') && !this.width.endsWith('px'))
            this.width += 'px';
        if (typeof this.maxWidth !== 'string')
            this.maxWidth = '100%';
        else if (!this.maxWidth.endsWith('%') && !this.maxWidth.endsWith('px'))
            this.maxWidth += 'px';
        this.initialized = true;
        this.checkImages();
        this.initSlideDragWatching();
        this.defineContainerWidth();
    };
    SliderCarouselComponent.prototype.checkImages = function () {
        var _this = this;
        if (this.images && this.images.length) {
            if (typeof this.images[0] !== 'string') {
                this.images.forEach(function (image) {
                    if (!image.md)
                        image.md = image.lg;
                    if (!image.sm)
                        image.sm = image.md;
                });
            }
            else {
                this.images = this.images.map(function (image) {
                    return { lg: image, md: image, sm: image };
                });
            }
            this.safeImages = this.images.map(function (image) {
                var _a, _b, _c, _d, _e, _f;
                var sizes = {
                    lg: {
                        url: ((_a = image.lg) === null || _a === void 0 ? void 0 : _a.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustUrl(image.lg) : image.lg,
                        style: ((_b = image.lg) === null || _b === void 0 ? void 0 : _b.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustStyle("url('" + image.lg + "')") : "url('" + image.lg + "')",
                        pure: image.lg
                    },
                    md: {
                        url: ((_c = image.md) === null || _c === void 0 ? void 0 : _c.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustUrl(image.md) : image.md,
                        style: ((_d = image.md) === null || _d === void 0 ? void 0 : _d.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustStyle("url('" + image.md + "')") : "url('" + image.md + "')",
                        pure: image.md
                    },
                    sm: {
                        url: ((_e = image.sm) === null || _e === void 0 ? void 0 : _e.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustUrl(image.sm) : image.sm,
                        style: ((_f = image.sm) === null || _f === void 0 ? void 0 : _f.startsWith('http')) ? _this.sanitizer.bypassSecurityTrustStyle("url('" + image.sm + "')") : "url('" + image.sm + "')",
                        pure: image.sm
                    }
                };
                return sizes;
            });
        }
        else {
            this.safeImages = [];
        }
    };
    SliderCarouselComponent.prototype.initSlideDragWatching = function () {
        var _this = this;
        if (this.innerImagesEl && this.innerImagesEl.nativeElement) {
            this.stopSlideDragWatching();
            if (this.helper.isMobileDevice())
                this.listeners = [
                    this.renderer.listen(document.body, 'touchstart', this.onStartDrag.bind(this)),
                    this.renderer.listen(document.body, 'touchmove', this.onDragging.bind(this)),
                    this.renderer.listen(document.body, 'touchend', this.onEndDrag.bind(this))
                ];
            else
                this.listeners = [
                    this.renderer.listen(document.body, 'mousedown', this.onStartDrag.bind(this)),
                    this.renderer.listen(document.body, 'mousemove', this.onDragging.bind(this)),
                    this.renderer.listen(document.body, 'mouseup', this.onEndDrag.bind(this)),
                ];
        }
        else
            setTimeout(function () { return _this.initSlideDragWatching(); }, 200);
    };
    SliderCarouselComponent.prototype.stopSlideDragWatching = function () {
        if (this.listeners && this.listeners.length)
            this.listeners.forEach(function (unListen) { return unListen(); });
    };
    SliderCarouselComponent.prototype.defineContainerWidth = function () {
        if (this.destroyed)
            return;
        if (!this.windowResizing) {
            var width = 0;
            if (this.sectionEl && this.sectionEl.nativeElement)
                width = this.sectionEl.nativeElement.clientWidth;
            if (width !== this.containerWidth)
                this.containerWidth = width;
        }
        setTimeout(this.defineContainerWidth.bind(this), 100);
    };
    SliderCarouselComponent.prototype.previewImage = function (image) {
        var _this = this;
        if (!this.previewRef) {
            this.previewRef = this.helper.openPreview({
                image: {
                    pureUrl: image.lg.pure,
                    safeUrl: image.lg.url,
                }
            });
            this.previewRef.onClose.subscribe(function () { return _this.previewRef = null; });
        }
    };
    SliderCarouselComponent.prototype.selectImage = function (imageIndex, event) {
        if (imageIndex !== this.currentImageIndex) {
            this.lastDirectionIsRight = imageIndex > this.currentImageIndex;
            this.currentImageIndex = imageIndex;
            if (event.target && this.imageListEl && this.imageListEl.nativeElement)
                this.scrollingToElement(event.target, this.lastDirectionIsRight);
        }
    };
    SliderCarouselComponent.prototype.goPrevImage = function (salt) {
        if (salt === void 0) { salt = 0; }
        if (this.currentImageIndex > 0) {
            if (salt) {
                if ((this.currentImageIndex - salt) >= 0)
                    this.currentImageIndex -= salt + 1;
                else
                    this.currentImageIndex = 0;
            }
            else
                this.currentImageIndex--;
            this.lastDirectionIsRight = false;
            var target = this.imageListEl.nativeElement.children[0].children[this.currentImageIndex];
            if (this.imageListEl && this.imageListEl.nativeElement)
                this.scrollingToElement(target, this.lastDirectionIsRight);
        }
    };
    SliderCarouselComponent.prototype.goNextImage = function (salt) {
        if (salt === void 0) { salt = 0; }
        if ((this.currentImageIndex + 1) < this.images.length) {
            if (salt) {
                if ((this.currentImageIndex + salt + 1) <= (this.images.length - 1))
                    this.currentImageIndex = salt + 1;
                else
                    this.currentImageIndex = this.images.length;
            }
            else
                this.currentImageIndex++;
            this.lastDirectionIsRight = true;
            var target = this.imageListEl.nativeElement.children[0].children[this.currentImageIndex];
            if (this.imageListEl && this.imageListEl.nativeElement)
                this.scrollingToElement(target, this.lastDirectionIsRight);
        }
    };
    SliderCarouselComponent.prototype.scrollingToElement = function (element, directionIsRight) {
        var scrollElement = this.imageListEl.nativeElement;
        if (scrollElement && scrollElement.scrollWidth > 0) {
            var blockWidth = element.clientWidth + 14;
            var scrollLeft = element.offsetLeft - 14;
            var scrollRight = element.offsetLeft + element.clientWidth + 14;
            var currentScrollLeft = scrollElement.scrollLeft;
            var currentScrollRight = scrollElement.scrollLeft + scrollElement.clientWidth;
            var scroll_1 = .1;
            if (directionIsRight && (currentScrollRight - scrollRight) < Math.floor(blockWidth / 2))
                scroll_1 = currentScrollLeft + blockWidth + 100;
            else if (!directionIsRight && (scrollLeft - currentScrollLeft) < Math.floor(blockWidth / 2))
                scroll_1 = currentScrollLeft - blockWidth;
            if (scroll_1 !== .1) {
                if (this.timerSroll)
                    clearInterval(this.timerSroll);
                this.timerSroll = this.helper.smoothScroll(scrollElement, scroll_1, 400, 'left');
            }
        }
    };
    SliderCarouselComponent.prototype.onKeydown = function (event) {
        if (!this.destroyed && !this.isDragging && [37, 39].indexOf(event.keyCode) >= 0) {
            if (event.keyCode === 37)
                this.goPrevImage();
            else
                this.goNextImage();
            if (this.previewRef)
                this.previewRef.instance.onImageChange({
                    pureUrl: this.currentImage.lg.pure,
                    safeUrl: this.currentImage.lg.url,
                });
        }
    };
    SliderCarouselComponent.prototype.onWindowResize = function () {
        var _this = this;
        if (!this.destroyed && !this.windowResizing) {
            this.windowResizing = true;
            setTimeout(function () {
                _this.containerWidth = _this.sectionEl.nativeElement.clientWidth;
                _this.windowResizing = false;
                setTimeout(function () {
                    if (_this.imageListEl && _this.imageListEl.nativeElement) {
                        var target = _this.imageListEl.nativeElement.children[0].children[_this.currentImageIndex];
                        if (_this.imageListEl && _this.imageListEl.nativeElement)
                            _this.scrollingToElement(target, _this.lastDirectionIsRight);
                    }
                }, 100);
            });
        }
    };
    SliderCarouselComponent.prototype.onStartDrag = function (event) {
        var isTouching = false;
        if (event.touches) {
            isTouching = true;
            event = event.touches[0];
        }
        if (isTouching || event.button === 0) {
            if (this.helper.elementIsChild(event.target, this.sectionEl.nativeElement)) {
                this.drag.startLeft = this.innerImagesEl.nativeElement.offsetLeft;
                this.drag.currentLeft = this.innerImagesEl.nativeElement.offsetLeft;
                this.drag.startOffset = event.clientX;
                this.drag.currentOffset = event.clientX;
                this.drag.state = 'start';
            }
        }
    };
    SliderCarouselComponent.prototype.onDragging = function (event) {
        if (event.touches)
            event = event.touches[0];
        if (this.drag.state === 'start' || this.drag.state === 'dragging') {
            this.drag.state = 'dragging';
            this.drag.currentOffset = event.clientX;
            if (this.drag.startOffset !== this.drag.currentOffset) {
                var draggingRight = this.drag.currentOffset > this.drag.startOffset;
                var delta = Math.abs(this.drag.currentOffset - this.drag.startOffset) * .8;
                if (((draggingRight && this.currentIsFisrt) || (!draggingRight && this.currentIsLast)) && delta > Math.floor(this.containerWidth / 3))
                    delta = Math.floor(this.containerWidth / 3);
                this.drag.currentLeft = this.drag.startLeft + ((draggingRight ? 1 : -1) * delta);
            }
            else
                this.drag.currentLeft = this.drag.startLeft;
        }
    };
    SliderCarouselComponent.prototype.onEndDrag = function (event) {
        var _this = this;
        var isTouching = false;
        if (event.touches) {
            isTouching = true;
            event = event.touches[0];
        }
        if (isTouching || event.button === 0) {
            var amountDragged_1 = Math.abs(this.drag.startOffset - this.drag.currentOffset);
            if (this.drag.state === 'dragging' && amountDragged_1 > 0)
                setTimeout(function () {
                    _this.drag.state = 'none';
                    var minDreg = 70;
                    if (amountDragged_1 >= minDreg) {
                        var draggingRight = _this.drag.currentOffset > _this.drag.startOffset;
                        var salts = (amountDragged_1 / _this.sectionEl.nativeElement.clientWidth) - 1;
                        if (salts >= 1)
                            salts = Math.floor(salts);
                        else
                            salts = 0;
                        if (draggingRight && !_this.currentIsFisrt)
                            _this.goPrevImage(salts);
                        else if (!draggingRight && !_this.currentIsLast)
                            _this.goNextImage(salts);
                    }
                });
            else {
                this.drag.state = 'none';
            }
        }
    };
    SliderCarouselComponent.prototype.ngOnDestroy = function () {
        this.destroyed = true;
        this.stopSlideDragWatching();
    };
    SliderCarouselComponent.ctorParameters = function () { return [
        { type: DomSanitizer },
        { type: Renderer2 },
        { type: Helper }
    ]; };
    SliderCarouselComponent.decorators = [
        { type: Component, args: [{
                    selector: 'slider-carousel',
                    template: "<section #section *ngIf=\"safeImages && safeImages.length\" [style.width]=\"width\" [style.maxWidth]=\"maxWidth\">\n    <div [hidden]=\"windowResizing\" *ngIf=\"containerWidth > 0\" class=\"image-controller animated fadeIn\" [style.maxWidth]=\"containerWidth + 'px'\">\n\n        <!-- INNER CONTAINER -->\n        <ul #innerImages *ngIf=\"!autoSize\"\n            [ngClass]=\"{'dragging-effect': isDragging}\"\n            [style.left]=\"(isDragging ? drag.currentLeft : (-currentImageIndex * containerWidth)) + 'px'\"\n            [style.height]=\"height\">\n            <li *ngFor=\"let image of safeImages; let i = index;\"\n                [style.backgroundImage]=\"image.md.style\"\n                [style.width]=\"containerWidth + 'px'\"\n                [ngClass]=\"{'cursor-pointer': preview, 'is-current': i === currentImageIndex}\"\n                (click)=\"!isDragging && previewImage(image)\">\n            </li>\n        </ul>\n        <ul #innerImages *ngIf=\"autoSize\"\n            [ngClass]=\"{'dragging-effect': isDragging}\"\n            [style.left]=\"(isDragging ? drag.currentLeft : (-currentImageIndex * containerWidth)) + 'px'\">\n            <div *ngFor=\"let image of safeImages; let i = index;\" [style.width]=\"containerWidth + 'px'\">\n\t\t\t\t<img [src]=\"image.md.url\" draggable=\"false\"\n                    [ngClass]=\"{'cursor-pointer': preview, 'is-current': i === currentImageIndex}\"\n                    (click)=\"!isDragging && previewImage(image)\"\n                />\n            </div>\n        </ul>\n\n        <!-- NAVIGATION BUTTONS -->\n        <div (click)=\"goPrevImage()\" class=\"image-controller-prev\" [ngClass]=\"{'disabled': currentImageIndex <= 0}\" role=\"button\">\n            <svg viewBox=\"0 0 456 456\">\n                <path d=\"M227.996,0C102.081,0,0,102.081,0,227.996c0,125.945,102.081,227.996,227.996,227.996\n\t\t\t\tc125.945,0,227.996-102.051,227.996-227.996C455.992,102.081,353.941,0,227.996,0z M299.435,238.788l-98.585,98.585\n\t\t\t\tc-5.928,5.897-15.565,5.897-21.492,0c-5.928-5.928-5.928-15.595,0-21.492l87.885-87.885l-87.885-87.885\n\t\t\t\tc-5.928-5.928-5.928-15.565,0-21.492s15.565-5.928,21.492,0l98.585,98.585c3.04,2.979,4.469,6.901,4.438,10.792\n\t\t\t\tC303.873,231.918,302.414,235.809,299.435,238.788z\"/>\n            </svg>                    \n        </div>\n        <div (click)=\"goNextImage()\" class=\"image-controller-next\" [ngClass]=\"{'disabled': (currentImageIndex + 1) >= safeImages.length}\" role=\"button\">\n            <svg viewBox=\"0 0 456 456\">\n                <path d=\"M227.996,0C102.081,0,0,102.081,0,227.996c0,125.945,102.081,227.996,227.996,227.996\n\t\t\t\tc125.945,0,227.996-102.051,227.996-227.996C455.992,102.081,353.941,0,227.996,0z M299.435,238.788l-98.585,98.585\n\t\t\t\tc-5.928,5.897-15.565,5.897-21.492,0c-5.928-5.928-5.928-15.595,0-21.492l87.885-87.885l-87.885-87.885\n\t\t\t\tc-5.928-5.928-5.928-15.565,0-21.492s15.565-5.928,21.492,0l98.585,98.585c3.04,2.979,4.469,6.901,4.438,10.792\n\t\t\t\tC303.873,231.918,302.414,235.809,299.435,238.788z\"/>\n            </svg>  \n        </div>\n\n    </div>\n\n    <!-- GALLERY NAVIGATION -->\n    <div [hidden]=\"windowResizing\" *ngIf=\"!windowResizing && containerWidth > 0\" #imageList class=\"footer-images animated fadeIn\" [style.maxWidth]=\"containerWidth + 'px'\">\n        <ul>\n            <li matRipple (click)=\"selectImage(i, $event)\" *ngFor=\"let image of safeImages; let i = index;\"\n                [ngClass]=\"{'is-current': i === currentImageIndex}\"\n                [style.backgroundImage]=\"image.sm.style\">\n            </li>\n        </ul>\n    </div>\n</section>",
                    host: {
                        '(document:keydown)': 'onKeydown($event)',
                        '(window:resize)': 'onWindowResize()'
                    }
                },] }
    ];
    SliderCarouselComponent.ctorParameters = function () { return [
        { type: DomSanitizer },
        { type: Renderer2 },
        { type: Helper }
    ]; };
    SliderCarouselComponent.propDecorators = {
        class: [{ type: HostBinding, args: ['class.slider-carousel',] }],
        sectionEl: [{ type: ViewChild, args: ['section',] }],
        imageListEl: [{ type: ViewChild, args: ['imageList',] }],
        innerImagesEl: [{ type: ViewChild, args: ['innerImages',] }],
        images: [{ type: Input }],
        preview: [{ type: Input }],
        height: [{ type: Input }],
        width: [{ type: Input }],
        maxWidth: [{ type: Input, args: ['max-width',] }],
        autoSize: [{ type: Input, args: ['auto-size',] }]
    };
    return SliderCarouselComponent;
}());
export { SliderCarouselComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2xpZGVyLWNhcm91c2VsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NsaWRlci1jYXJvdXNlbC8iLCJzb3VyY2VzIjpbInNsaWRlci1jYXJvdXNlbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzlILE9BQU8sRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRzdFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFFbEM7SUE0REMsaUNBQ1MsU0FBdUIsRUFDdkIsUUFBbUIsRUFDbkIsTUFBYztRQUZkLGNBQVMsR0FBVCxTQUFTLENBQWM7UUFDdkIsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNuQixXQUFNLEdBQU4sTUFBTSxDQUFRO1FBdERzQixVQUFLLEdBQVksSUFBSSxDQUFDO1FBTW5ELFdBQU0sR0FBMEQsRUFBRSxDQUFDO1FBRW5FLFlBQU8sR0FBWSxJQUFJLENBQUM7UUFDeEIsV0FBTSxHQUFXLE9BQU8sQ0FBQztRQUN6QixVQUFLLEdBQVcsTUFBTSxDQUFDO1FBQ1osYUFBUSxHQUFXLE1BQU0sQ0FBQztRQUMxQixhQUFRLEdBQVksS0FBSyxDQUFDO1FBRTlDLGVBQVUsR0FJWCxFQUFFLENBQUM7UUFFRixnQkFBVyxHQUFZLEtBQUssQ0FBQztRQUU3QixzQkFBaUIsR0FBVyxDQUFDLENBQUM7UUFDOUIseUJBQW9CLEdBQVksS0FBSyxDQUFDO1FBSXRDLG1CQUFjLEdBQVcsQ0FBQyxDQUFDO1FBRTFCLGNBQVMsR0FBWSxLQUFLLENBQUM7UUFDNUIsbUJBQWMsR0FBWSxLQUFLLENBQUM7UUFNL0IsY0FBUyxHQUFtQixFQUFFLENBQUM7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Q0FBQztxQkFDekI7Z0JBQ0YsQ0FBQyxDQUFDLENBQUM7aUJBQ0M7Z0JBQ0osSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDO2FBQ3pCO1NBQ0Q7SUFDRixDQUFDO0lBRUQsNkNBQVcsR0FBWDtRQUNDLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQzlCLENBQUM7O2dCQS9UbUIsWUFBWTtnQkFDYixTQUFTO2dCQUNYLE1BQU07OztnQkEvRHZCLFNBQVMsU0FBQztvQkFDVixRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixrbEhBQStDO29CQUMvQyxJQUFJLEVBQUU7d0JBQ0wsb0JBQW9CLEVBQUUsbUJBQW1CO3dCQUN6QyxpQkFBaUIsRUFBRSxrQkFBa0I7cUJBQ3JDO2lCQUNEOzs7Z0JBWlEsWUFBWTtnQkFEd0UsU0FBUztnQkFJN0YsTUFBTTs7O3dCQVdiLFdBQVcsU0FBQyx1QkFBdUI7NEJBRW5DLFNBQVMsU0FBQyxTQUFTOzhCQUNuQixTQUFTLFNBQUMsV0FBVztnQ0FDckIsU0FBUyxTQUFDLGFBQWE7eUJBRXZCLEtBQUs7MEJBRUwsS0FBSzt5QkFDTCxLQUFLO3dCQUNMLEtBQUs7MkJBQ0wsS0FBSyxTQUFDLFdBQVc7MkJBQ2pCLEtBQUssU0FBQyxXQUFXOztJQXlXbkIsOEJBQUM7Q0FBQSxBQTlYRCxJQThYQztTQXRYWSx1QkFBdUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSG9zdEJpbmRpbmcsIElucHV0LCBFbGVtZW50UmVmLCBWaWV3Q2hpbGQsIE9uRGVzdHJveSwgT25DaGFuZ2VzLCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IERvbVNhbml0aXplciwgU2FmZVVybCwgU2FmZVN0eWxlIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBTbGlkZXJDYXJvdXNlbFByZXZpZXdDb21wb25lbnQgfSBmcm9tICcuL3NsaWRlci1jYXJvdXNlbC1wcmV2aWV3L3NsaWRlci1jYXJvdXNlbC1wcmV2aWV3LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBIZWxwZXIgfSBmcm9tICcuL2hlbHBlcic7XG5cbkBDb21wb25lbnQoe1xuXHRzZWxlY3RvcjogJ3NsaWRlci1jYXJvdXNlbCcsXG5cdHRlbXBsYXRlVXJsOiAnLi9zbGlkZXItY2Fyb3VzZWwuY29tcG9uZW50Lmh0bWwnLFxuXHRob3N0OiB7XG5cdFx0Jyhkb2N1bWVudDprZXlkb3duKSc6ICdvbktleWRvd24oJGV2ZW50KScsXG5cdFx0Jyh3aW5kb3c6cmVzaXplKSc6ICdvbldpbmRvd1Jlc2l6ZSgpJ1xuXHR9XG59KVxuZXhwb3J0IGNsYXNzIFNsaWRlckNhcm91c2VsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG5cdEBIb3N0QmluZGluZygnY2xhc3Muc2xpZGVyLWNhcm91c2VsJykgcHVibGljIGNsYXNzOiBib29sZWFuID0gdHJ1ZTtcblxuXHRAVmlld0NoaWxkKCdzZWN0aW9uJykgcHJpdmF0ZSBzZWN0aW9uRWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+O1xuXHRAVmlld0NoaWxkKCdpbWFnZUxpc3QnKSBwcml2YXRlIGltYWdlTGlzdEVsOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50Pjtcblx0QFZpZXdDaGlsZCgnaW5uZXJJbWFnZXMnKSBwcml2YXRlIGlubmVySW1hZ2VzRWw6IEVsZW1lbnRSZWY8SFRNTEVsZW1lbnQ+O1xuXG5cdEBJbnB1dCgpIHB1YmxpYyBpbWFnZXM6IHsgbGc6IHN0cmluZywgbWQ/OiBzdHJpbmcsIHNtPzogc3RyaW5nIH1bXSB8IHN0cmluZ1tdID0gW107XG5cblx0QElucHV0KCkgcHVibGljIHByZXZpZXc6IGJvb2xlYW4gPSB0cnVlO1xuXHRASW5wdXQoKSBwdWJsaWMgaGVpZ2h0OiBzdHJpbmcgPSAnNTAwcHgnO1xuXHRASW5wdXQoKSBwdWJsaWMgd2lkdGg6IHN0cmluZyA9ICcxMDAlJztcblx0QElucHV0KCdtYXgtd2lkdGgnKSBwdWJsaWMgbWF4V2lkdGg6IHN0cmluZyA9ICcxMDAlJztcblx0QElucHV0KCdhdXRvLXNpemUnKSBwdWJsaWMgYXV0b1NpemU6IGJvb2xlYW4gPSBmYWxzZTtcblxuXHRwdWJsaWMgc2FmZUltYWdlczoge1xuXHRcdGxnOiB7IHVybDogU2FmZVVybCB8IHN0cmluZywgc3R5bGU6IFNhZmVTdHlsZSB8IHN0cmluZywgcHVyZTogc3RyaW5nIH0sXG5cdFx0bWQ6IHsgdXJsOiBTYWZlVXJsIHwgc3RyaW5nLCBzdHlsZTogU2FmZVN0eWxlIHwgc3RyaW5nLCBwdXJlOiBzdHJpbmcgfSxcblx0XHRzbTogeyB1cmw6IFNhZmVVcmwgfCBzdHJpbmcsIHN0eWxlOiBTYWZlU3R5bGUgfCBzdHJpbmcsIHB1cmU6IHN0cmluZyB9XG5cdH1bXSA9IFtdO1xuXG5cdHB1YmxpYyBpbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xuXG5cdHB1YmxpYyBjdXJyZW50SW1hZ2VJbmRleDogbnVtYmVyID0gMDtcblx0cHVibGljIGxhc3REaXJlY3Rpb25Jc1JpZ2h0OiBib29sZWFuID0gZmFsc2U7XG5cblx0cHJpdmF0ZSB0aW1lclNyb2xsOiBhbnk7XG5cblx0cHVibGljIGNvbnRhaW5lcldpZHRoOiBudW1iZXIgPSAwO1xuXG5cdHByaXZhdGUgZGVzdHJveWVkOiBib29sZWFuID0gZmFsc2U7XG5cdHB1YmxpYyB3aW5kb3dSZXNpemluZzogYm9vbGVhbiA9IGZhbHNlO1xuXHRwcml2YXRlIHByZXZpZXdSZWY6IHtcblx0XHRvbkNsb3NlOiBPYnNlcnZhYmxlPGFueT4sXG5cdFx0aW5zdGFuY2U6IFNsaWRlckNhcm91c2VsUHJldmlld0NvbXBvbmVudFxuXHR9O1xuXG5cdHByaXZhdGUgbGlzdGVuZXJzOiAoKCkgPT4gdm9pZClbXSA9IFtdO1xuXG5cdHB1YmxpYyBnZXQgY3VycmVudEltYWdlKCkgeyByZXR1cm4gdGhpcy5zYWZlSW1hZ2VzW3RoaXMuY3VycmVudEltYWdlSW5kZXhdOyB9XG5cdHB1YmxpYyBnZXQgY3VycmVudElzRmlzcnQoKSB7IHJldHVybiB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID09PSAwOyB9XG5cdHB1YmxpYyBnZXQgY3VycmVudElzTGFzdCgpIHsgcmV0dXJuIHRoaXMuY3VycmVudEltYWdlSW5kZXggPT09ICh0aGlzLmltYWdlcy5sZW5ndGggLSAxKTsgfVxuXG5cdHB1YmxpYyBnZXQgaXNEcmFnZ2luZygpIHsgcmV0dXJuIHRoaXMuZHJhZy5zdGF0ZSAhPT0gJ25vbmUnOyB9XG5cdHB1YmxpYyBkcmFnID0ge1xuXHRcdHN0YXRlOiAnbm9uZScsIC8vICdzdGFydCcsICdkcmFnZ2luZycsICdub25lJ1xuXHRcdHN0YXJ0T2Zmc2V0OiAwLFxuXHRcdGN1cnJlbnRPZmZzZXQ6IDAsXG5cdFx0c3RhcnRMZWZ0OiAwLFxuXHRcdGN1cnJlbnRMZWZ0OiAwLFxuXHR9O1xuXG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByaXZhdGUgc2FuaXRpemVyOiBEb21TYW5pdGl6ZXIsXG5cdFx0cHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuXHRcdHByaXZhdGUgaGVscGVyOiBIZWxwZXJcblx0KSB7XG5cdH1cblxuXHRuZ09uSW5pdCgpIHtcblx0fVxuXG5cdG5nT25DaGFuZ2VzKCkge1xuXHRcdHRoaXMucHJlcGFyZSgpO1xuXHR9XG5cblx0cHJpdmF0ZSBwcmVwYXJlKCkge1xuXHRcdGlmICh0eXBlb2YgdGhpcy5oZWlnaHQgIT09ICdzdHJpbmcnKVxuXHRcdFx0dGhpcy5oZWlnaHQgPSAnNTAwcHgnO1xuXHRcdGVsc2UgaWYgKCF0aGlzLmhlaWdodC5lbmRzV2l0aCgnJScpICYmICF0aGlzLmhlaWdodC5lbmRzV2l0aCgncHgnKSlcblx0XHRcdHRoaXMuaGVpZ2h0ICs9ICdweCc7XG5cblx0XHRpZiAodHlwZW9mIHRoaXMud2lkdGggIT09ICdzdHJpbmcnKVxuXHRcdFx0dGhpcy53aWR0aCA9ICcxMDAlJztcblx0XHRlbHNlIGlmICghdGhpcy53aWR0aC5lbmRzV2l0aCgnJScpICYmICF0aGlzLndpZHRoLmVuZHNXaXRoKCdweCcpKVxuXHRcdFx0dGhpcy53aWR0aCArPSAncHgnO1xuXG5cdFx0aWYgKHR5cGVvZiB0aGlzLm1heFdpZHRoICE9PSAnc3RyaW5nJylcblx0XHRcdHRoaXMubWF4V2lkdGggPSAnMTAwJSc7XG5cdFx0ZWxzZSBpZiAoIXRoaXMubWF4V2lkdGguZW5kc1dpdGgoJyUnKSAmJiAhdGhpcy5tYXhXaWR0aC5lbmRzV2l0aCgncHgnKSlcblx0XHRcdHRoaXMubWF4V2lkdGggKz0gJ3B4JztcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdHRoaXMuY2hlY2tJbWFnZXMoKTtcblx0XHR0aGlzLmluaXRTbGlkZURyYWdXYXRjaGluZygpO1xuXHRcdHRoaXMuZGVmaW5lQ29udGFpbmVyV2lkdGgoKTtcblx0fVxuXG5cdHByaXZhdGUgY2hlY2tJbWFnZXMoKSB7XG5cdFx0aWYgKHRoaXMuaW1hZ2VzICYmIHRoaXMuaW1hZ2VzLmxlbmd0aCkge1xuXHRcdFx0aWYgKHR5cGVvZiB0aGlzLmltYWdlc1swXSAhPT0gJ3N0cmluZycpIHtcblx0XHRcdFx0KHRoaXMuaW1hZ2VzIGFzIHsgbGc6IHN0cmluZywgbWQ/OiBzdHJpbmcsIHNtPzogc3RyaW5nIH1bXSkuZm9yRWFjaCgoaW1hZ2UpID0+IHtcblx0XHRcdFx0XHRpZiAoIWltYWdlLm1kKVxuXHRcdFx0XHRcdFx0aW1hZ2UubWQgPSBpbWFnZS5sZztcblx0XHRcdFx0XHRpZiAoIWltYWdlLnNtKVxuXHRcdFx0XHRcdFx0aW1hZ2Uuc20gPSBpbWFnZS5tZDtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0dGhpcy5pbWFnZXMgPSAodGhpcy5pbWFnZXMgYXMgc3RyaW5nW10pLm1hcCgoaW1hZ2UpID0+IHtcblx0XHRcdFx0XHRyZXR1cm4geyBsZzogaW1hZ2UsIG1kOiBpbWFnZSwgc206IGltYWdlIH07XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnNhZmVJbWFnZXMgPSAodGhpcy5pbWFnZXMgYXMgeyBsZzogc3RyaW5nLCBtZDogc3RyaW5nLCBzbTogc3RyaW5nIH1bXSkubWFwKChpbWFnZSkgPT4ge1xuXHRcdFx0XHRsZXQgc2l6ZXMgPSB7XG5cdFx0XHRcdFx0bGc6IHsgXG5cdFx0XHRcdFx0XHR1cmw6IGltYWdlLmxnPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0VXJsKGltYWdlLmxnKSA6IGltYWdlLmxnLFxuXHRcdFx0XHRcdFx0c3R5bGU6IGltYWdlLmxnPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoYHVybCgnJHtpbWFnZS5sZ30nKWApIDogYHVybCgnJHtpbWFnZS5sZ30nKWAsXG5cdFx0XHRcdFx0XHRwdXJlOiBpbWFnZS5sZ1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0bWQ6IHsgXG5cdFx0XHRcdFx0XHR1cmw6IGltYWdlLm1kPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0VXJsKGltYWdlLm1kKSA6IGltYWdlLm1kLFxuXHRcdFx0XHRcdFx0c3R5bGU6IGltYWdlLm1kPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoYHVybCgnJHtpbWFnZS5tZH0nKWApIDogYHVybCgnJHtpbWFnZS5tZH0nKWAsXG5cdFx0XHRcdFx0XHRwdXJlOiBpbWFnZS5tZFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0c206IHsgXG5cdFx0XHRcdFx0XHR1cmw6IGltYWdlLnNtPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0VXJsKGltYWdlLnNtKSA6IGltYWdlLnNtLFxuXHRcdFx0XHRcdFx0c3R5bGU6IGltYWdlLnNtPy5zdGFydHNXaXRoKCdodHRwJykgPyB0aGlzLnNhbml0aXplci5ieXBhc3NTZWN1cml0eVRydXN0U3R5bGUoYHVybCgnJHtpbWFnZS5zbX0nKWApIDogYHVybCgnJHtpbWFnZS5zbX0nKWAsXG5cdFx0XHRcdFx0XHRwdXJlOiBpbWFnZS5zbVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fTtcblx0XHRcdFx0cmV0dXJuIHNpemVzO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0dGhpcy5zYWZlSW1hZ2VzID0gW107XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBpbml0U2xpZGVEcmFnV2F0Y2hpbmcoKSB7XG5cdFx0aWYgKHRoaXMuaW5uZXJJbWFnZXNFbCAmJiB0aGlzLmlubmVySW1hZ2VzRWwubmF0aXZlRWxlbWVudCkge1xuXHRcdFx0dGhpcy5zdG9wU2xpZGVEcmFnV2F0Y2hpbmcoKTtcblxuXHRcdFx0aWYgKHRoaXMuaGVscGVyLmlzTW9iaWxlRGV2aWNlKCkpXG5cdFx0XHRcdHRoaXMubGlzdGVuZXJzID0gW1xuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LmJvZHksICd0b3VjaHN0YXJ0JywgdGhpcy5vblN0YXJ0RHJhZy5iaW5kKHRoaXMpKSxcblx0XHRcdFx0XHR0aGlzLnJlbmRlcmVyLmxpc3Rlbihkb2N1bWVudC5ib2R5LCAndG91Y2htb3ZlJywgdGhpcy5vbkRyYWdnaW5nLmJpbmQodGhpcykpLFxuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LmJvZHksICd0b3VjaGVuZCcsIHRoaXMub25FbmREcmFnLmJpbmQodGhpcykpXG5cdFx0XHRcdF07XG5cdFx0XHRlbHNlXG5cdFx0XHRcdHRoaXMubGlzdGVuZXJzID0gW1xuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LmJvZHksICdtb3VzZWRvd24nLCB0aGlzLm9uU3RhcnREcmFnLmJpbmQodGhpcykpLFxuXHRcdFx0XHRcdHRoaXMucmVuZGVyZXIubGlzdGVuKGRvY3VtZW50LmJvZHksICdtb3VzZW1vdmUnLCB0aGlzLm9uRHJhZ2dpbmcuYmluZCh0aGlzKSksXG5cdFx0XHRcdFx0dGhpcy5yZW5kZXJlci5saXN0ZW4oZG9jdW1lbnQuYm9keSwgJ21vdXNldXAnLCB0aGlzLm9uRW5kRHJhZy5iaW5kKHRoaXMpKSxcblx0XHRcdFx0XTtcblx0XHR9XG5cdFx0ZWxzZVxuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB0aGlzLmluaXRTbGlkZURyYWdXYXRjaGluZygpLCAyMDApO1xuXHR9XG5cblx0cHJpdmF0ZSBzdG9wU2xpZGVEcmFnV2F0Y2hpbmcoKSB7XG5cdFx0aWYgKHRoaXMubGlzdGVuZXJzICYmIHRoaXMubGlzdGVuZXJzLmxlbmd0aClcblx0XHRcdHRoaXMubGlzdGVuZXJzLmZvckVhY2goKHVuTGlzdGVuKSA9PiB1bkxpc3RlbigpKTtcblx0fVxuXG5cdHByaXZhdGUgZGVmaW5lQ29udGFpbmVyV2lkdGgoKSB7XG5cdFx0aWYgKHRoaXMuZGVzdHJveWVkKVxuXHRcdFx0cmV0dXJuO1xuXG5cdFx0aWYgKCF0aGlzLndpbmRvd1Jlc2l6aW5nKSB7XG5cdFx0XHRsZXQgd2lkdGggPSAwO1xuXHRcdFx0aWYgKHRoaXMuc2VjdGlvbkVsICYmIHRoaXMuc2VjdGlvbkVsLm5hdGl2ZUVsZW1lbnQpXG5cdFx0XHRcdHdpZHRoID0gdGhpcy5zZWN0aW9uRWwubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aDtcblxuXHRcdFx0aWYgKHdpZHRoICE9PSB0aGlzLmNvbnRhaW5lcldpZHRoKVxuXHRcdFx0XHR0aGlzLmNvbnRhaW5lcldpZHRoID0gd2lkdGg7XG5cdFx0fVxuXG5cdFx0c2V0VGltZW91dCh0aGlzLmRlZmluZUNvbnRhaW5lcldpZHRoLmJpbmQodGhpcyksIDEwMCk7XG5cdH1cblxuXHRwdWJsaWMgcHJldmlld0ltYWdlKGltYWdlOiBhbnkpIHtcblx0XHRpZiAoIXRoaXMucHJldmlld1JlZikge1xuXHRcdFx0dGhpcy5wcmV2aWV3UmVmID0gdGhpcy5oZWxwZXIub3BlblByZXZpZXcoe1xuXHRcdFx0XHRpbWFnZToge1xuXHRcdFx0XHRcdHB1cmVVcmw6IGltYWdlLmxnLnB1cmUsXG5cdFx0XHRcdFx0c2FmZVVybDogaW1hZ2UubGcudXJsLFxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5wcmV2aWV3UmVmLm9uQ2xvc2Uuc3Vic2NyaWJlKCgpID0+IHRoaXMucHJldmlld1JlZiA9IG51bGwpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBzZWxlY3RJbWFnZShpbWFnZUluZGV4OiBudW1iZXIsIGV2ZW50KSB7XG5cdFx0aWYgKGltYWdlSW5kZXggIT09IHRoaXMuY3VycmVudEltYWdlSW5kZXgpIHtcblx0XHRcdHRoaXMubGFzdERpcmVjdGlvbklzUmlnaHQgPSBpbWFnZUluZGV4ID4gdGhpcy5jdXJyZW50SW1hZ2VJbmRleDtcblx0XHRcdHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBpbWFnZUluZGV4O1xuXG5cdFx0XHRpZiAoZXZlbnQudGFyZ2V0ICYmIHRoaXMuaW1hZ2VMaXN0RWwgJiYgdGhpcy5pbWFnZUxpc3RFbC5uYXRpdmVFbGVtZW50KVxuXHRcdFx0XHR0aGlzLnNjcm9sbGluZ1RvRWxlbWVudChldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQsIHRoaXMubGFzdERpcmVjdGlvbklzUmlnaHQpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBnb1ByZXZJbWFnZShzYWx0OiBudW1iZXIgPSAwKSB7XG5cdFx0aWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPiAwKSB7XG5cdFx0XHRpZiAoc2FsdCkge1xuXHRcdFx0XHRpZiAoKHRoaXMuY3VycmVudEltYWdlSW5kZXggLSBzYWx0KSA+PSAwKVxuXHRcdFx0XHRcdHRoaXMuY3VycmVudEltYWdlSW5kZXggLT0gc2FsdCArIDE7XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gMDtcblx0XHRcdH1cblx0XHRcdGVsc2Vcblx0XHRcdFx0dGhpcy5jdXJyZW50SW1hZ2VJbmRleC0tO1xuXG5cdFx0XHR0aGlzLmxhc3REaXJlY3Rpb25Jc1JpZ2h0ID0gZmFsc2U7XG5cblx0XHRcdGxldCB0YXJnZXQgPSB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0gYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRpZiAodGhpcy5pbWFnZUxpc3RFbCAmJiB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQpXG5cdFx0XHRcdHRoaXMuc2Nyb2xsaW5nVG9FbGVtZW50KHRhcmdldCwgdGhpcy5sYXN0RGlyZWN0aW9uSXNSaWdodCk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGdvTmV4dEltYWdlKHNhbHQ6IG51bWJlciA9IDApIHtcblx0XHRpZiAoKHRoaXMuY3VycmVudEltYWdlSW5kZXggKyAxKSA8IHRoaXMuaW1hZ2VzLmxlbmd0aCkge1xuXHRcdFx0aWYgKHNhbHQpIHtcblx0XHRcdFx0aWYgKCh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICsgc2FsdCArIDEpIDw9ICh0aGlzLmltYWdlcy5sZW5ndGggLSAxKSlcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gc2FsdCArIDE7XG5cdFx0XHRcdGVsc2Vcblx0XHRcdFx0XHR0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gdGhpcy5pbWFnZXMubGVuZ3RoO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZVxuXHRcdFx0XHR0aGlzLmN1cnJlbnRJbWFnZUluZGV4Kys7XG5cblx0XHRcdHRoaXMubGFzdERpcmVjdGlvbklzUmlnaHQgPSB0cnVlO1xuXG5cdFx0XHRsZXQgdGFyZ2V0ID0gdGhpcy5pbWFnZUxpc3RFbC5uYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdLmNoaWxkcmVuW3RoaXMuY3VycmVudEltYWdlSW5kZXhdIGFzIEhUTUxFbGVtZW50O1xuXHRcdFx0aWYgKHRoaXMuaW1hZ2VMaXN0RWwgJiYgdGhpcy5pbWFnZUxpc3RFbC5uYXRpdmVFbGVtZW50KVxuXHRcdFx0XHR0aGlzLnNjcm9sbGluZ1RvRWxlbWVudCh0YXJnZXQsIHRoaXMubGFzdERpcmVjdGlvbklzUmlnaHQpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgc2Nyb2xsaW5nVG9FbGVtZW50KGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBkaXJlY3Rpb25Jc1JpZ2h0OiBib29sZWFuKSB7XG5cdFx0bGV0IHNjcm9sbEVsZW1lbnQgPSB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQ7XG5cdFx0aWYgKHNjcm9sbEVsZW1lbnQgJiYgc2Nyb2xsRWxlbWVudC5zY3JvbGxXaWR0aCA+IDApe1xuXHRcdFx0bGV0IGJsb2NrV2lkdGggPSBlbGVtZW50LmNsaWVudFdpZHRoICsgMTQ7XG5cdFx0XHRsZXQgc2Nyb2xsTGVmdCA9IGVsZW1lbnQub2Zmc2V0TGVmdCAtIDE0O1xuXHRcdFx0bGV0IHNjcm9sbFJpZ2h0ID0gZWxlbWVudC5vZmZzZXRMZWZ0ICsgZWxlbWVudC5jbGllbnRXaWR0aCArIDE0O1xuXHRcdFx0bGV0IGN1cnJlbnRTY3JvbGxMZWZ0ID0gc2Nyb2xsRWxlbWVudC5zY3JvbGxMZWZ0O1xuXHRcdFx0bGV0IGN1cnJlbnRTY3JvbGxSaWdodCA9IHNjcm9sbEVsZW1lbnQuc2Nyb2xsTGVmdCArIHNjcm9sbEVsZW1lbnQuY2xpZW50V2lkdGg7XG5cblx0XHRcdGxldCBzY3JvbGwgPSAuMTtcblxuXHRcdFx0aWYgKGRpcmVjdGlvbklzUmlnaHQgJiYgKGN1cnJlbnRTY3JvbGxSaWdodCAtIHNjcm9sbFJpZ2h0KSA8IE1hdGguZmxvb3IoYmxvY2tXaWR0aCAvIDIpKVxuXHRcdFx0XHRzY3JvbGwgPSBjdXJyZW50U2Nyb2xsTGVmdCArIGJsb2NrV2lkdGggKyAxMDA7XG5cdFx0XHRlbHNlIGlmICghZGlyZWN0aW9uSXNSaWdodCAmJiAoc2Nyb2xsTGVmdCAtIGN1cnJlbnRTY3JvbGxMZWZ0KSA8IE1hdGguZmxvb3IoYmxvY2tXaWR0aCAvIDIpKVxuXHRcdFx0XHRzY3JvbGwgPSBjdXJyZW50U2Nyb2xsTGVmdCAtIGJsb2NrV2lkdGg7XG5cblx0XHRcdGlmIChzY3JvbGwgIT09IC4xKSB7XG5cdFx0XHRcdGlmICh0aGlzLnRpbWVyU3JvbGwpIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lclNyb2xsKTtcblx0XHRcdFx0dGhpcy50aW1lclNyb2xsID0gdGhpcy5oZWxwZXIuc21vb3RoU2Nyb2xsKHNjcm9sbEVsZW1lbnQsIHNjcm9sbCwgNDAwLCAnbGVmdCcpO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBvbktleWRvd24oZXZlbnQpIHtcblx0XHRpZiAoIXRoaXMuZGVzdHJveWVkICYmICF0aGlzLmlzRHJhZ2dpbmcgJiYgWzM3LCAzOV0uaW5kZXhPZihldmVudC5rZXlDb2RlKSA+PSAwKSB7XG4gICAgICAgICAgICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMzcpXG4gICAgICAgICAgICAgICAgdGhpcy5nb1ByZXZJbWFnZSgpO1xuICAgICAgICAgICAgZWxzZVxuXHRcdFx0XHR0aGlzLmdvTmV4dEltYWdlKCk7XG5cdFx0XHRcdFxuXHRcdFx0aWYgKHRoaXMucHJldmlld1JlZilcblx0XHRcdFx0dGhpcy5wcmV2aWV3UmVmLmluc3RhbmNlLm9uSW1hZ2VDaGFuZ2Uoe1xuXHRcdFx0XHRcdHB1cmVVcmw6IHRoaXMuY3VycmVudEltYWdlLmxnLnB1cmUsXG5cdFx0XHRcdFx0c2FmZVVybDogdGhpcy5jdXJyZW50SW1hZ2UubGcudXJsLFxuXHRcdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHRwdWJsaWMgb25XaW5kb3dSZXNpemUoKSB7XG5cdFx0aWYgKCF0aGlzLmRlc3Ryb3llZCAmJiAhdGhpcy53aW5kb3dSZXNpemluZykge1xuXHRcdFx0dGhpcy53aW5kb3dSZXNpemluZyA9IHRydWU7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dGhpcy5jb250YWluZXJXaWR0aCA9IHRoaXMuc2VjdGlvbkVsLm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGg7XG5cdFx0XHRcdHRoaXMud2luZG93UmVzaXppbmcgPSBmYWxzZTtcblxuXHRcdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0XHRpZiAodGhpcy5pbWFnZUxpc3RFbCAmJiB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQpIHtcblx0XHRcdFx0XHRcdGxldCB0YXJnZXQgPSB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW5bMF0uY2hpbGRyZW5bdGhpcy5jdXJyZW50SW1hZ2VJbmRleF0gYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5pbWFnZUxpc3RFbCAmJiB0aGlzLmltYWdlTGlzdEVsLm5hdGl2ZUVsZW1lbnQpXG5cdFx0XHRcdFx0XHRcdHRoaXMuc2Nyb2xsaW5nVG9FbGVtZW50KHRhcmdldCwgdGhpcy5sYXN0RGlyZWN0aW9uSXNSaWdodCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCAxMDApO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBvblN0YXJ0RHJhZyhldmVudCkge1xuXHRcdGxldCBpc1RvdWNoaW5nID0gZmFsc2U7XG5cdFx0aWYgKGV2ZW50LnRvdWNoZXMpIHtcblx0XHRcdGlzVG91Y2hpbmcgPSB0cnVlO1xuXHRcdFx0ZXZlbnQgPSBldmVudC50b3VjaGVzWzBdO1xuXHRcdH1cblx0XHRcblx0XHRpZiAoaXNUb3VjaGluZyB8fCBldmVudC5idXR0b24gPT09IDApIHtcblxuXHRcdFx0aWYgKHRoaXMuaGVscGVyLmVsZW1lbnRJc0NoaWxkKGV2ZW50LnRhcmdldCwgdGhpcy5zZWN0aW9uRWwubmF0aXZlRWxlbWVudCkpXG5cdFx0XHR7XG5cdFx0XHRcdHRoaXMuZHJhZy5zdGFydExlZnQgPSB0aGlzLmlubmVySW1hZ2VzRWwubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuXHRcdFx0XHR0aGlzLmRyYWcuY3VycmVudExlZnQgPSB0aGlzLmlubmVySW1hZ2VzRWwubmF0aXZlRWxlbWVudC5vZmZzZXRMZWZ0O1xuXHRcdFx0XHR0aGlzLmRyYWcuc3RhcnRPZmZzZXQgPSBldmVudC5jbGllbnRYO1xuXHRcdFx0XHR0aGlzLmRyYWcuY3VycmVudE9mZnNldCA9IGV2ZW50LmNsaWVudFg7XG5cdFx0XHRcdHRoaXMuZHJhZy5zdGF0ZSA9ICdzdGFydCc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBvbkRyYWdnaW5nKGV2ZW50KSB7XG5cdFx0aWYgKGV2ZW50LnRvdWNoZXMpXG5cdFx0XHRldmVudCA9IGV2ZW50LnRvdWNoZXNbMF07XG5cblx0XHRpZiAodGhpcy5kcmFnLnN0YXRlID09PSAnc3RhcnQnIHx8IHRoaXMuZHJhZy5zdGF0ZSA9PT0gJ2RyYWdnaW5nJykge1xuXG5cdFx0XHR0aGlzLmRyYWcuc3RhdGUgPSAnZHJhZ2dpbmcnO1xuXHRcdFx0dGhpcy5kcmFnLmN1cnJlbnRPZmZzZXQgPSBldmVudC5jbGllbnRYO1xuXG5cdFx0XHRpZiAodGhpcy5kcmFnLnN0YXJ0T2Zmc2V0ICE9PSB0aGlzLmRyYWcuY3VycmVudE9mZnNldCkge1xuXHRcdFx0XHRsZXQgZHJhZ2dpbmdSaWdodCA9IHRoaXMuZHJhZy5jdXJyZW50T2Zmc2V0ID4gdGhpcy5kcmFnLnN0YXJ0T2Zmc2V0O1xuXHRcdFx0XHRsZXQgZGVsdGEgPSBNYXRoLmFicyh0aGlzLmRyYWcuY3VycmVudE9mZnNldCAtIHRoaXMuZHJhZy5zdGFydE9mZnNldCkgKiAuODtcblxuXHRcdFx0XHRpZiAoKChkcmFnZ2luZ1JpZ2h0ICYmIHRoaXMuY3VycmVudElzRmlzcnQpIHx8ICghZHJhZ2dpbmdSaWdodCAmJiB0aGlzLmN1cnJlbnRJc0xhc3QpKSAmJiBkZWx0YSA+IE1hdGguZmxvb3IodGhpcy5jb250YWluZXJXaWR0aCAvIDMpKVxuXHRcdFx0XHRcdGRlbHRhID0gTWF0aC5mbG9vcih0aGlzLmNvbnRhaW5lcldpZHRoIC8gMyk7XG5cblx0XHRcdFx0dGhpcy5kcmFnLmN1cnJlbnRMZWZ0ID0gdGhpcy5kcmFnLnN0YXJ0TGVmdCArICgoZHJhZ2dpbmdSaWdodCA/IDEgOiAtMSkgKiBkZWx0YSk7XG5cdFx0XHR9XG5cdFx0XHRlbHNlXG5cdFx0XHRcdHRoaXMuZHJhZy5jdXJyZW50TGVmdCA9IHRoaXMuZHJhZy5zdGFydExlZnQ7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBvbkVuZERyYWcoZXZlbnQpIHtcblx0XHRsZXQgaXNUb3VjaGluZyA9IGZhbHNlO1xuXHRcdGlmIChldmVudC50b3VjaGVzKSB7XG5cdFx0XHRpc1RvdWNoaW5nID0gdHJ1ZTtcblx0XHRcdGV2ZW50ID0gZXZlbnQudG91Y2hlc1swXTtcblx0XHR9XG5cdFx0XG5cdFx0aWYgKGlzVG91Y2hpbmcgfHwgZXZlbnQuYnV0dG9uID09PSAwKSB7XG5cdFx0XHRsZXQgYW1vdW50RHJhZ2dlZCA9IE1hdGguYWJzKHRoaXMuZHJhZy5zdGFydE9mZnNldCAtIHRoaXMuZHJhZy5jdXJyZW50T2Zmc2V0KTtcblxuXHRcdFx0aWYgKHRoaXMuZHJhZy5zdGF0ZSA9PT0gJ2RyYWdnaW5nJyAmJiBhbW91bnREcmFnZ2VkID4gMClcblx0XHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdFx0dGhpcy5kcmFnLnN0YXRlID0gJ25vbmUnO1xuXG5cdFx0XHRcdFx0bGV0IG1pbkRyZWcgPSA3MDtcblxuXHRcdFx0XHRcdGlmIChhbW91bnREcmFnZ2VkID49IG1pbkRyZWcpIHtcblx0XHRcdFx0XHRcdGxldCBkcmFnZ2luZ1JpZ2h0ID0gdGhpcy5kcmFnLmN1cnJlbnRPZmZzZXQgPiB0aGlzLmRyYWcuc3RhcnRPZmZzZXQ7XG5cblx0XHRcdFx0XHRcdGxldCBzYWx0cyA9IChhbW91bnREcmFnZ2VkIC8gdGhpcy5zZWN0aW9uRWwubmF0aXZlRWxlbWVudC5jbGllbnRXaWR0aCkgLSAxO1xuXHRcdFx0XHRcdFx0aWYgKHNhbHRzID49IDEpXG5cdFx0XHRcdFx0XHRcdHNhbHRzID0gTWF0aC5mbG9vcihzYWx0cyk7XG5cdFx0XHRcdFx0XHRlbHNlXG5cdFx0XHRcdFx0XHRcdHNhbHRzID0gMDtcblxuXHRcdFx0XHRcdFx0aWYgKGRyYWdnaW5nUmlnaHQgJiYgIXRoaXMuY3VycmVudElzRmlzcnQpXG5cdFx0XHRcdFx0XHRcdHRoaXMuZ29QcmV2SW1hZ2Uoc2FsdHMpO1xuXHRcdFx0XHRcdFx0ZWxzZSBpZiAoIWRyYWdnaW5nUmlnaHQgJiYgIXRoaXMuY3VycmVudElzTGFzdClcblx0XHRcdFx0XHRcdFx0dGhpcy5nb05leHRJbWFnZShzYWx0cyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdGVsc2Uge1xuXHRcdFx0XHR0aGlzLmRyYWcuc3RhdGUgPSAnbm9uZSc7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0bmdPbkRlc3Ryb3koKSB7XG5cdFx0dGhpcy5kZXN0cm95ZWQgPSB0cnVlO1xuXHRcdHRoaXMuc3RvcFNsaWRlRHJhZ1dhdGNoaW5nKCk7XG5cdH1cblxufVxuIl19